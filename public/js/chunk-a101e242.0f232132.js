(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a101e242"],{"24bf":function(t,s,a){"use strict";a.r(s);var l=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"app-release"},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("\n                部署发布单 - \n                "),t.deployDetail.status==t.$root.ApplyStatusNone?a("span",[t._v("待上线")]):t._e(),t.deployDetail.status==t.$root.ApplyStatusIng?a("span",{staticClass:"app-color-info"},[t._v(t._s(t.$t("onlineing")))]):t._e(),t.deployDetail.status==t.$root.ApplyStatusSuccess?a("span",{staticClass:"app-color-success"},[t._v(t._s(t.$t("have_onlined")))]):t._e(),t.deployDetail.status==t.$root.ApplyStatusFailed?a("span",{staticClass:"app-color-error"},[t._v(t._s(t.$t("online_failed")))]):t._e(),t.deployDetail.status==t.$root.ApplyStatusRollback?a("span",{staticClass:"app-color-error"},[t._v(t._s(t.$t("rollback")))]):t._e()])]),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:10}},[a("span",{staticClass:"sp-title"},[t._v(t._s(t.$t("apply_order"))+":")]),a("span",[t._v(t._s(this.applyDetail.name))])]),a("el-col",{attrs:{span:14}},[a("span",{staticClass:"sp-title"},[t._v(t._s(t.$t("belong_project"))+":")]),a("span",[t._v(t._s(this.projectDetail.name))])])],1),a("el-row",{staticClass:"app-mt-20",attrs:{gutter:20}},[a("el-col",{attrs:{span:10}},[a("span",{staticClass:"sp-title"},[t._v(t._s(t.$t("deploy_mode"))+":")]),this.projectDetail.deploy_mode==t.$root.DeployModeBranch?a("span",[a("i",{staticClass:"iconfont icon-branch"}),t._v(" "+t._s(t.$t("branch_deploy"))+" - "+t._s(t.applyDetail.branch_name)+" - commit:"),""!=t.applyDetail.commit_version?[t._v(t._s(t.applyDetail.commit_version))]:[t._v("HEAD")]],2):a("span",[a("i",{staticClass:"iconfont icon-tag"}),t._v(" "+t._s(t.$t("tag_deploy"))+" - "+t._s(t.applyDetail.branch_name)+"\n                ")])]),a("el-col",{attrs:{span:14}},[a("span",{staticClass:"sp-title"},[t._v(t._s(t.$t("submiter"))+":")]),a("span",[t._v(t._s(t.applyDetail.username)+" - "+t._s(t.applyDetail.email)+" - "+t._s(t.$root.FormatDateTime(t.applyDetail.ctime)))])])],1),a("el-row",{staticClass:"app-mt-20",attrs:{gutter:20}},[a("el-col",{attrs:{span:16}},[a("span",{staticClass:"sp-title"},[t._v(t._s(t.$t("apply_type"))+":")]),a("span",[t.applyDetail.is_rollback_apply?a("span",{staticClass:"app-color-warning"},[t._v("回滚单")]):a("span",[t._v("上线单")])])])],1),a("el-row",{staticClass:"app-mt-20",attrs:{gutter:20}},[a("el-col",{attrs:{span:16}},[a("span",{staticClass:"sp-title"},[t._v(t._s(t.$t("description"))+":")]),a("span",[t._v(t._s(t.applyDetail.description))])])],1),a("div",{staticClass:"app-divider"}),a("div",[t.deployDetail.status!=t.$root.ApplyStatusNone&&t.deployDetail.status!=t.$root.ApplyStatusIng&&t.deployDetail.status!=t.$root.ApplyStatusFailed||t.applyDetail.is_rollback_apply?t._e():[a("el-button",{attrs:{disabled:t.deployDetail.status==t.$root.ApplyStatusIng,loading:t.buildDetail.status==t.$root.ApplyStatusNone,size:"medium",icon:"iconfont small left icon-build",type:"primary"},on:{click:t.startBuildHandler}},[t._v(t._s(t.$t("build")))]),t.buildDetail.status==t.$root.ApplyStatusNone?a("el-button",{attrs:{size:"medium",type:"warning",icon:"iconfont small left icon-stop"},on:{click:t.stopBuildHandler}},[t._v(t._s(t.$t("forced_termination")))]):t._e()],a("el-row",{staticClass:"app-mt-20",attrs:{gutter:20}},[a("el-col",{attrs:{span:10}},[a("span",{staticClass:"sp-title"},[t._v(t._s(t.$t("last_buid_time"))+":")]),t.buildDetail.start_time?a("span",[t._v(t._s(t.$root.FormatDateTime(t.buildDetail.start_time)))]):t._e(),t.buildDetail.finish_time?a("span",[t._v(" - "+t._s(t.$t("cost_time"))+": "+t._s(t.$root.FormatDateDuration(1e3*(t.buildDetail.finish_time-t.buildDetail.start_time))))]):t._e()]),a("el-col",{attrs:{span:14}},[a("span",{staticClass:"sp-title"},[t._v(t._s(t.$t("status"))+":")]),a("span",[t.isStopBuildLoading&&t.buildDetail.status==t.$root.BuildStatusStart?a("span",{staticClass:"app-color-warning"},[t._v("\n                            "+t._s(t.$t("stopping"))+"...\n                        ")]):t.buildDetail.status==t.$root.BuildStatusStart?a("span",{staticClass:"app-color-info"},[t._v(t._s(t.$t("building"))+"...")]):t.buildDetail.status==t.$root.BuildStatusSuccess?a("span",{staticClass:"app-color-success"},[t._v(t._s(t.$t("build_finish")))]):t.buildDetail.status==t.$root.BuildStatusFailed?a("span",{staticClass:"app-color-error"},[t._v(t._s(t.$t("build_failed")))]):a("span",[t._v("\n                            "+t._s(t.$t("unbuild"))+"\n                        ")])])])],1),a("el-row",{staticClass:"app-mt-20",attrs:{gutter:20}},[a("el-col",{attrs:{span:10}},[a("span",{staticClass:"sp-title"},[t._v(t._s(t.$t("build_log"))+":")]),a("span",[a("span",{staticClass:"app-link",on:{click:t.openDialogBuildHandler}},[t._v(t._s(t.$t("view")))])])]),a("el-col",{attrs:{span:14}},[a("span",{staticClass:"sp-title"},[t._v(t._s(t.$t("tar_pack_path"))+":")]),t.buildDetail.tar?a("span",[t._v(t._s(t.buildDetail.tar))]):a("span",[t._v(t._s(t.$t("uncreate")))])])],1)],2),a("div",{staticClass:"app-divider"}),a("div",[t.deployDetail.status==t.$root.ApplyStatusNone||t.deployDetail.status==t.$root.ApplyStatusIng?a("el-button",{attrs:{loading:t.deployDetail.status==t.$root.ApplyStatusIng,size:"medium",icon:"iconfont small left icon-send",type:"primary"},on:{click:t.startDeployHandler}},[t._v(t._s(t.$t("deploy")))]):t._e(),t.deployDetail.status==t.$root.ApplyStatusFailed?a("el-button",{attrs:{loading:t.deployDetail.status==t.$root.ApplyStatusIng,size:"medium",icon:"iconfont small left icon-send",type:"primary"},on:{click:t.startDeployHandler}},[t._v(t._s(t.$t("redeploy")))]):t._e(),t.deployDetail.status==t.$root.ApplyStatusIng?a("el-button",{attrs:{size:"medium",icon:"iconfont small left icon-stop",type:"warning"},on:{click:t.stopDeployHandler}},[t._v(t._s(t.$t("forced_termination")))]):t._e(),t.deployDetail.status!=t.$root.ApplyStatusSuccess&&t.deployDetail.status!=t.$root.ApplyStatusFailed||!t.applyDetail.rollback_id?t._e():[a("el-button",{attrs:{icon:"iconfont small left icon-rollback",size:"medium",type:"danger"},on:{click:t.rollbackDeployHandler}},[t._v(t._s(t.$t("rollback")))]),a("el-alert",{staticClass:"app-mt-10",attrs:{title:t.$t("rollback_apply_order_tips"),type:"warning"}})],t.deployDetail.status==t.$root.ApplyStatusRollback?a("div",[a("el-alert",{staticClass:"app-mt-10",attrs:{type:"warning","show-icon":"",closable:!1}},[a("template",{slot:"title"},[a("strong",[t._v(t._s(t.$t("rollback_created")))]),t._v("\n                        -\n                        "),1==t.applyDetail.rollback_status?a("strong",[t._v(t._s(t.$t("rollback_unstart")))]):2==t.applyDetail.rollback_status?a("strong",[t._v(t._s(t.$t("rollbacking")))]):3==t.applyDetail.rollback_status?a("strong",[t._v(t._s(t.$t("rollback_success")))]):4==t.applyDetail.rollback_status?a("strong",[t._v(t._s(t.$t("rollback_failed")))]):5==t.applyDetail.rollback_status?a("strong",[t._v(t._s(t.$t("rollback_drop")))]):a("strong",[t._v(t._s(t.$t("rollback_unknow")))]),t._v("\n                        -\n                        "),a("span",{staticClass:"app-link",on:{click:function(s){t.$router.push({query:{id:t.applyDetail.rollback_apply_id}})}}},[t._v(t._s(t.$t("click_to_view_rollback_order")))])])],2)],1):t._e(),t.applyDetail.is_rollback_apply?a("div",[a("el-alert",{staticClass:"app-mt-10",attrs:{type:"warning","show-icon":"",closable:!1}},[a("template",{slot:"title"},[t._v("\n                        "+t._s(t.$t("rollback_tips"))+", "),a("span",{staticClass:"app-link",on:{click:function(s){t.$router.push({query:{id:t.applyDetail.rollback_apply_id}})}}},[t._v(t._s(t.$t("back_apply")))])])],2)],1):t._e(),a("el-card",{staticClass:"app-mt-20 app-cluster-group",attrs:{shadow:"never"}},[a("div",{attrs:{slot:"header"},slot:"header"},[t._v(t._s(t.$t("cluster_list")))]),a("el-collapse",{attrs:{value:t.projectDetail.online_cluster_ids}},t._l(t.onlineCluster,function(s){return a("el-collapse-item",{key:s.id,staticClass:"app-cluster-item",attrs:{name:s.id}},[a("template",{slot:"title"},[a("i",{staticClass:"iconfont small left icon-cluster"}),t._v("\n                            "+t._s(s.name)+"  \n                            "),t.deployDetail.groupStatus[s.id]==t.$root.DeployGroupStatusNone?a("span",{staticClass:"app-color-gray"},[a("i",{staticClass:"iconfont small left icon-wait"}),t._v(t._s(t.$t("wait_deploy")))]):t.deployDetail.groupStatus[s.id]==t.$root.DeployGroupStatusStart?a("span",{staticClass:"app-color-info"},[a("i",{staticClass:"iconfont el-icon-loading"}),t._v(t._s(t.$t("deploying")))]):t.deployDetail.groupStatus[s.id]==t.$root.DeployGroupStatusSuccess?a("span",{staticClass:"app-color-success"},[a("i",{staticClass:"iconfont small left icon-success"}),t._v(t._s(t.$t("deploy_success")))]):t.deployDetail.groupStatus[s.id]==t.$root.DeployGroupStatusFailed?a("span",{staticClass:"app-color-error"},[a("i",{staticClass:"iconfont small left icon-failed"}),t._v(t._s(t.$t("deploy_failed")))]):t._e()]),t._l(s.servers,function(s){return a("div",{key:s.id,staticClass:"app-item"},[a("i",{staticClass:"iconfont small left icon-server"}),t._v("\n                            "+t._s(s.ip)+" - "+t._s(s.name)+"\n                            "),void 0==t.deployDetail.servers[s.id]?a("span"):t.deployDetail.servers[s.id].status==t.$root.DeployGroupStatusNone?a("span",{staticClass:"app-color-gray"},[a("i",{staticClass:"iconfont small left icon-wait"})]):t.deployDetail.servers[s.id].status==t.$root.DeployGroupStatusStart?a("span",{staticClass:"app-color-info"},[a("i",{staticClass:"iconfont el-icon-loading"}),a("span",{staticClass:"app-link",on:{click:function(a){t.openDialogDeployHandler(s.id)}}},[t._v(t._s(t.$t("view")))])]):t.deployDetail.servers[s.id].status==t.$root.DeployGroupStatusSuccess?a("span",{staticClass:"app-color-success"},[a("i",{staticClass:"iconfont small left icon-success"}),a("span",{staticClass:"app-link",on:{click:function(a){t.openDialogDeployHandler(s.id)}}},[t._v(t._s(t.$t("view")))])]):t.deployDetail.servers[s.id].status==t.$root.DeployGroupStatusFailed?a("span",{staticClass:"app-color-error"},[a("i",{staticClass:"iconfont small left icon-failed"}),a("span",{staticClass:"app-link",on:{click:function(a){t.openDialogDeployHandler(s.id)}}},[t._v(t._s(t.$t("view")))])]):t._e()])})],2)}),1)],1)],2)],1),a("el-dialog",{attrs:{width:t.$root.DialogNormalWidth,title:t.$t("build_log"),visible:t.dialogBuildVisible},on:{"update:visible":function(s){t.dialogBuildVisible=s},close:t.closeDialogBuildHandler}},[t.buildDetail.status==t.$root.BuildStatusFailed?a("div",[a("i",{staticClass:"app-color-error el-icon-warning"}),t._v(" "+t._s(t.$t("build_failed"))+": "),t.buildDetail.errmsg?a("span",{staticClass:"app-color-error"},[t._v(t._s(t.buildDetail.errmsg))]):t._e()]):t._e(),t.buildDetail.status==t.$root.BuildStatusSuccess?a("div",[a("i",{staticClass:"app-color-success el-icon-success"}),t._v(" "+t._s(t.$t("build_finish")))]):t._e(),t.buildDetail.status==t.$root.BuildStatusStart?a("div",[a("i",{staticClass:"app-color-info el-icon-info"}),t._v(" "+t._s(t.$t("build_ing")))]):t._e(),a("div",{staticClass:"app-terminal-log"},[t._l(t.buildDetail.output,function(s,l){return[a("div",{key:l},[a("div",{staticClass:"terminal-cmd",class:{"app-color-success":s.success,"app-color-error":!s.success}},[t._v("\n                        [cmd] $ "+t._s(s.cmd)+"\n                        "),s.success?a("span",{staticClass:"iconfont icon-right"}):a("span",{staticClass:"iconfont icon-wrong"})]),a("div",[a("pre",[t._v(t._s(s.stdout))])]),a("div",[a("pre",[t._v(t._s(s.stderr))])])])]}),t.buildDetail.status==t.$root.BuildStatusStart?a("i",{staticClass:"el-icon-loading app-color-white"}):t._e()],2)]),a("el-dialog",{attrs:{width:t.$root.DialogNormalWidth,title:t.$t("deploy_log"),visible:t.dialogDeployVisible},on:{"update:visible":function(s){t.dialogDeployVisible=s},close:t.closeDialogDeployHandler}},[t.serverDeployDetail.status==t.$root.DeployGroupStatusFailed?a("div",[a("i",{staticClass:"app-color-error el-icon-warning"}),t._v(" "+t._s(t.$t("deploy_failed"))+": "),t.serverDeployDetail.errmsg?a("span",{staticClass:"app-color-error"},[t._v(t._s(t.serverDeployDetail.errmsg))]):t._e()]):t._e(),t.serverDeployDetail.status==t.$root.DeployGroupStatusSuccess?a("div",[a("i",{staticClass:"app-color-success el-icon-success"}),t._v(" "+t._s(t.$t("deploy_success")))]):t._e(),t.serverDeployDetail.status==t.$root.DeployGroupStatusStart?a("div",[a("i",{staticClass:"app-color-info el-icon-info"}),t._v(" "+t._s(t.$t("deploying")))]):t._e(),a("div",{staticClass:"app-terminal-log"},[t._l(t.serverDeployDetail.output,function(s,l){return[a("div",{key:l},[a("div",{staticClass:"terminal-cmd",class:{"app-color-success":s.success,"app-color-error":!s.success}},[t._v("\n                        [cmd] $ "+t._s(s.cmd)+"\n                        "),s.success?a("span",{staticClass:"iconfont icon-right"}):a("span",{staticClass:"iconfont icon-wrong"})]),a("div",[a("pre",[t._v(t._s(s.stdout))])]),a("div",[a("pre",[t._v(t._s(s.stderr))])])])]}),1==t.serverDeployDetail.status?a("i",{staticClass:"el-icon-loading app-color-white"}):t._e()],2)])],1)},i=[],e=(a("7f7f"),a("ac6a"),a("41db")),o=a("1c06"),n={data:function(){return{id:0,applyDetail:{},projectDetail:{},buildDetail:{},deployDetail:{},dialogBuildVisible:!1,isStopBuildLoading:!1,onlineCluster:{},dialogDeployVisible:!1,serverDeploySid:0}},watch:{projectDetail:function(){var t=this,s=[];this.projectDetail.online_cluster_ids.forEach(function(a){if(t.projectDetail.cluster_list[a]){var l=t.projectDetail.cluster_list[a],i=[];t.projectDetail.server_list.forEach(function(t){t.group_id==a&&i.push(t)}),s.push({id:l.id,name:l.name,servers:i})}}),this.onlineCluster=s},"$route.query":function(){this.initPageLoader()}},computed:{serverDeployDetail:function(){var t={};if(this.deployDetail.servers&&this.deployDetail.servers[this.serverDeploySid]){var s=this.deployDetail.servers[this.serverDeploySid];t={status:s.status,errmsg:s.errmsg,output:s.task}}return t}},methods:{rollbackDeployHandler:function(){var t=this;this.$root.ConfirmDelete(function(){var s=t.$message({message:t.$t("rollback_creating"),type:"info",iconClass:"el-icon-loading",duration:0});Object(e["m"])({id:t.id}).then(function(a){setTimeout(function(){t.loadDeployStatus(),t.initApplyDetail(),s.close()},1e3)})},this.$t("makesure_rollback_order"))},openDialogDeployHandler:function(t){this.serverDeploySid=t,this.dialogDeployVisible=!0},closeDialogDeployHandler:function(){this.dialogDeployVisible=!1},closeDialogBuildHandler:function(){this.dialogBuildVisible=!1},openDialogBuildHandler:function(){this.dialogBuildVisible=!0},startBuildHandler:function(){var t=this;Object(e["j"])({id:this.id}).then(function(s){t.loadBuildStatus()})},stopBuildHandler:function(){var t=this;Object(e["l"])({id:this.id}).then(function(s){t.isStopBuildLoading=!0})},startDeployHandler:function(){var t=this;Object(e["n"])({id:this.id}).then(function(s){t.loadDeployStatus()}).catch(function(s){s.code==o["a"].CODE_ERR_NO_DATA&&t.$confirm(t.$t("build_success_and_deploy"),t.$t("deploy_tips"),{confirmButtonText:t.$t("start_build"),cancelButtonText:t.$t("i_known"),type:"warning"}).then(function(){t.startBuildHandler()}).catch(function(){})})},stopDeployHandler:function(){var t=this;Object(e["p"])({id:this.id}).then(function(s){t.loadDeployStatus()})},deployStatusDetail:function(t){var s={},a={};t.task_list&&t.task_list.forEach(function(t){s[t.group_id]=t.status,t.content&&t.content.forEach(function(t){a[t.id]={status:t.status,errmsg:t.error,task:t.task?t.task:[]}})}),this.deployDetail={status:t.status,groupStatus:s,servers:a}},loadBuildStatus:function(){var t=this;Object(e["k"])({id:this.id}).then(function(s){if(t.buildDetail=s,1==s.status){var a=t;setTimeout(function(){a.loadBuildStatus()},5e3)}else t.isStopBuildLoading=!1})},loadDeployStatus:function(){var t=this;Object(e["o"])({id:this.id}).then(function(s){if(t.deployStatusDetail(s),s.status==t.$root.ApplyStatusIng){var a=t;setTimeout(function(){a.loadDeployStatus()},5e3)}})},initApplyDetail:function(){var t=this;Object(e["b"])({id:this.id}).then(function(s){t.applyDetail=s,Object(e["f"])({id:t.applyDetail.project_id}).then(function(s){t.projectDetail=s})})},initPageLoader:function(){this.id=this.$route.query.id,this.initApplyDetail(),this.loadBuildStatus(),this.loadDeployStatus()}},mounted:function(){this.initPageLoader()}},r=n,p=a("2877"),c=Object(p["a"])(r,l,i,!1,null,null,null);c.options.__file="Release.vue";s["default"]=c.exports},"41db":function(t,s,a){"use strict";a.d(s,"f",function(){return i}),a.d(s,"h",function(){return e}),a.d(s,"e",function(){return o}),a.d(s,"d",function(){return n}),a.d(s,"b",function(){return r}),a.d(s,"a",function(){return p}),a.d(s,"i",function(){return c}),a.d(s,"c",function(){return u}),a.d(s,"g",function(){return d}),a.d(s,"j",function(){return _}),a.d(s,"k",function(){return y}),a.d(s,"l",function(){return f}),a.d(s,"n",function(){return v}),a.d(s,"o",function(){return D}),a.d(s,"p",function(){return b}),a.d(s,"m",function(){return $});var l=a("ead3");function i(t){return Object(l["a"])("/deploy/apply/project/detail",t)}function e(t){return Object(l["b"])("/deploy/apply/submit",t)}function o(){return Object(l["a"])("/deploy/apply/project/all")}function n(t){return Object(l["a"])("/deploy/apply/list",t)}function r(t){return Object(l["a"])("/deploy/apply/detail",t)}function p(t){return Object(l["b"])("/deploy/apply/audit",t)}function c(t){return Object(l["b"])("/deploy/apply/update",t)}function u(t){return Object(l["b"])("/deploy/apply/drop",t)}function d(t){return Object(l["a"])("/deploy/apply/rollbacklist",t)}function _(t){return Object(l["b"])("/deploy/build/start",t)}function y(t){return Object(l["a"])("/deploy/build/status",t)}function f(t){return Object(l["b"])("/deploy/build/stop",t)}function v(t){return Object(l["b"])("/deploy/deploy/start",t)}function D(t){return Object(l["a"])("/deploy/deploy/status",t)}function b(t){return Object(l["b"])("/deploy/deploy/stop",t)}function $(t){return Object(l["b"])("/deploy/deploy/rollback",t)}},"7f7f":function(t,s,a){var l=a("86cc").f,i=Function.prototype,e=/^\s*function ([^ (]*)/,o="name";o in i||a("9e1e")&&l(i,o,{configurable:!0,get:function(){try{return(""+this).match(e)[1]}catch(t){return""}}})}}]);
//# sourceMappingURL=chunk-a101e242.0f232132.js.map